generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CC {
  ccId           String        @id
  userId         String?       @unique
  memberName     String?
  hotCredential  String?
  coldCredential String?
  status         String?
  createdAt      DateTime?     @default(now())
  updatedAt      DateTime?
  User           User?         @relation(fields: [userId], references: [id])
  OnchainVote    OnchainVote[]
}

model CrowdfundingCampaign {
  id              Int           @id @default(autoincrement())
  proposalDraftId Int           @unique
  createdAt       DateTime?     @default(now())
  updatedAt       DateTime?
  ProposalDraft   ProposalDraft @relation(fields: [proposalDraftId], references: [id])
}

model Drep {
  drepId         String        @id
  userId         String?       @unique
  name           String?
  paymentAddress String?
  iconUrl        String?
  doNotList      Boolean?
  votingPower    BigInt
  createdAt      DateTime?     @default(now())
  updatedAt      DateTime?
  User           User?         @relation(fields: [userId], references: [id])
  OnchainVote    OnchainVote[]
}

model LastIngestedTime {
  id String @id
}

model NCL {
  id        String   @id
  year      Int      @unique
  epoch     Int
  current   BigInt   @default(0)
  limit     BigInt
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model OnchainVote {
  id          String    @id
  txHash      String
  proposalId  String
  vote        VoteType?
  voterType   VoterType
  votingPower BigInt?
  anchorUrl   String?
  anchorHash  String?
  votedAt     DateTime? @default(now())
  createdAt   DateTime? @default(now())
  updatedAt   DateTime?
  drepId      String?
  spoId       String?
  ccId        String?
  CC          CC?       @relation(fields: [ccId], references: [ccId])
  Drep        Drep?     @relation(fields: [drepId], references: [drepId])
  Proposal    Proposal  @relation(fields: [proposalId], references: [proposalId])
  SPO         SPO?      @relation(fields: [spoId], references: [poolId])

  @@unique([txHash, proposalId, voterType, drepId, spoId, ccId])
}

model Proposal {
  id                              Int             @id @default(autoincrement())
  proposalId                      String          @unique
  txHash                          String
  certIndex                       String
  title                           String
  description                     String?
  rationale                       String?
  governanceActionType            GovernanceType?
  status                          ProposalStatus  @default(ACTIVE)
  submissionEpoch                 Int?
  ratifiedEpoch                   Int?
  enactedEpoch                    Int?
  droppedEpoch                    Int?
  expiredEpoch                    Int?
  expirationEpoch                 Int?
  drepTotalVotePower              BigInt?
  drepActiveYesVotePower          BigInt?
  drepActiveNoVotePower           BigInt?
  drepActiveAbstainVotePower      BigInt?
  drepAlwaysAbstainVotePower      BigInt?
  drepAlwaysNoConfidenceVotePower BigInt?
  drepInactiveVotePower           BigInt?
  spoTotalVotePower               BigInt?
  spoActiveYesVotePower           BigInt?
  spoActiveNoVotePower            BigInt?
  spoActiveAbstainVotePower       BigInt?
  spoAlwaysAbstainVotePower       BigInt?
  spoAlwaysNoConfidenceVotePower  BigInt?
  metadata                        String?
  createdAt                       DateTime?       @default(now())
  updatedAt                       DateTime?
  OnchainVote                     OnchainVote[]

  @@unique([txHash, certIndex])
}

model ProposalDraft {
  id                   Int                   @id @default(autoincrement())
  governanceActionType GovernanceType
  title                String
  abstract             String?
  motivation           String?
  rationale            String?
  comment              String?
  references           String?
  externalUpdates      String?
  metadata             String?
  createdAt            DateTime?             @default(now())
  updatedAt            DateTime?
  CrowdfundingCampaign CrowdfundingCampaign?
}

model SPO {
  poolId      String        @id
  userId      String?       @unique
  poolName    String?
  ticker      String?
  iconUrl     String?
  votingPower BigInt
  createdAt   DateTime?     @default(now())
  updatedAt   DateTime?
  OnchainVote OnchainVote[]
  User        User?         @relation(fields: [userId], references: [id])
}

model User {
  id               String    @id
  walletAddress    String?
  stakeKeyLovelace Float?
  jwt              String?
  createdAt        DateTime? @default(now())
  updatedAt        DateTime?
  CC               CC?
  Drep             Drep?
  SPO              SPO?
}

enum GovernanceType {
  INFO_ACTION
  TREASURY_WITHDRAWALS
  NEW_CONSTITUTION
  HARD_FORK_INITIATION
  PROTOCOL_PARAMETER_CHANGE
  NO_CONFIDENCE
  UPDATE_COMMITTEE
}

enum ProposalStatus {
  ACTIVE
  RATIFIED
  ENACTED
  EXPIRED
  CLOSED
}

enum VoteType {
  YES
  NO
  ABSTAIN
}

enum VoterType {
  DREP
  SPO
  CC
}