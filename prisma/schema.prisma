generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model cc {
  cc_id           String         @id
  user_id         String?        @unique
  member_name     String?
  hot_credential  String?
  cold_credential String?
  status          String?
  created_at      DateTime?      @default(now())
  updated_at      DateTime?
  user            user?          @relation(fields: [user_id], references: [id])
  onchain_votes   onchain_vote[]
}

model crowdfunding_campaign {
  id                Int            @id @default(autoincrement())
  proposal_draft_id Int            @unique
  created_at        DateTime?      @default(now())
  updated_at        DateTime?
  proposal_draft    proposal_draft @relation(fields: [proposal_draft_id], references: [id])
}

model drep {
  drep_id       String         @id
  user_id       String?        @unique
  name          String?
  payment_addr  String?
  icon_url      String?
  do_not_list   Boolean?
  voting_power  BigInt
  created_at    DateTime?      @default(now())
  updated_at    DateTime?
  user          user?          @relation(fields: [user_id], references: [id])
  onchain_votes onchain_vote[]
}

model last_ingested_time {
  id String @id
}

model ncl {
  id         String   @id
  year       Int      @unique
  epoch      Int
  current    BigInt   @default(0)
  limit      BigInt
  created_at DateTime @default(now())
  updated_at DateTime
}

model onchain_vote {
  id           String     @id
  tx_hash      String
  proposal_id  String
  vote         vote_type?
  voter_type   voter_type
  voting_power BigInt?
  anchor_url   String?
  anchor_hash  String?
  rationale    String?
  voted_at     DateTime?  @default(now())
  created_at   DateTime?  @default(now())
  updated_at   DateTime?
  drep_id      String?
  spo_id       String?
  cc_id        String?

  cc       cc?      @relation(fields: [cc_id], references: [cc_id])
  drep     drep?    @relation(fields: [drep_id], references: [drep_id])
  proposal proposal @relation(fields: [proposal_id], references: [proposal_id])
  spo      spo?     @relation(fields: [spo_id], references: [pool_id])

  @@unique([tx_hash, proposal_id, voter_type, drep_id, spo_id, cc_id])
}

model proposal {
  id                              Int              @id @default(autoincrement())
  proposal_id                     String           @unique
  tx_hash                         String
  cert_index                      String
  title                           String
  description                     String?
  rationale                       String?
  governance_action_type          governance_type?
  status                          proposal_status  @default(ACTIVE)
  submission_epoch                Int?
  ratified_epoch                  Int?
  enacted_epoch                   Int?
  dropped_epoch                   Int?
  expired_epoch                   Int?
  expiration_epoch                Int?
  drep_total_vote_power           BigInt?
  drep_active_yes_vote_power      BigInt?
  drep_active_no_vote_power       BigInt?
  drep_active_abstain_vote_power  BigInt?
  drep_always_abstain_vote_power  BigInt?
  drep_always_no_confidence_power BigInt?
  drep_inactive_vote_power        BigInt?
  spo_total_vote_power            BigInt?
  spo_active_yes_vote_power       BigInt?
  spo_active_no_vote_power        BigInt?
  spo_active_abstain_vote_power   BigInt?
  spo_always_abstain_vote_power   BigInt?
  spo_always_no_confidence_power  BigInt?
  metadata                        String?
  created_at                      DateTime?        @default(now())
  updated_at                      DateTime?
  onchain_votes                   onchain_vote[]

  @@unique([tx_hash, cert_index])
}

model proposal_draft {
  id                     Int                    @id @default(autoincrement())
  governance_action_type governance_type
  title                  String
  abstract               String?
  motivation             String?
  rationale              String?
  comment                String?
  references             String?
  external_updates       String?
  metadata               String?
  created_at             DateTime?              @default(now())
  updated_at             DateTime?
  crowdfunding_campaign  crowdfunding_campaign?
}

model spo {
  pool_id       String         @id
  user_id       String?        @unique
  pool_name     String?
  ticker        String?
  icon_url      String?
  voting_power  BigInt
  created_at    DateTime?      @default(now())
  updated_at    DateTime?
  onchain_votes onchain_vote[]
  user          user?          @relation(fields: [user_id], references: [id])
}

model user {
  id                 String    @id
  wallet_address     String?
  stake_key_lovelace Float?
  jwt                String?
  created_at         DateTime? @default(now())
  updated_at         DateTime?
  cc                 cc?
  drep               drep?
  spo                spo?
}

enum governance_type {
  INFO_ACTION
  TREASURY_WITHDRAWALS
  NEW_CONSTITUTION
  HARD_FORK_INITIATION
  PROTOCOL_PARAMETER_CHANGE
  NO_CONFIDENCE
  UPDATE_COMMITTEE
}

enum proposal_status {
  ACTIVE
  RATIFIED
  ENACTED
  EXPIRED
  CLOSED
}

enum vote_type {
  YES
  NO
  ABSTAIN
}

enum voter_type {
  DREP
  SPO
  CC
}
